openapi: 3.0.3
info:
  title: Green Spoon Backend API
  version: 1.0.0
  description: API contract for Green Spoon cloud kitchen frontend integration.
servers:
  - url: http://localhost:3000
    description: Local development
  - url: https://api.greenspoonfoods.com
    description: Production
tags:
  - name: Auth
  - name: Admin
  - name: Tenants
  - name: Payments
  - name: Orders
  - name: Tracking
  - name: Notifications
  - name: Observability
paths:
  /health:
    get:
      tags: [Observability]
      summary: Service health check
      responses:
        '200':
          description: Backend health status
          content:
            application/json:
              schema:
                type: object
                required: [ok, service, timestamp]
                properties:
                  ok:
                    type: boolean
                    example: true
                  service:
                    type: string
                    example: greenspoon-backend
                  timestamp:
                    type: integer
                    format: int64
  /metrics:
    get:
      tags: [Observability]
      summary: Prometheus metrics endpoint
      responses:
        '200':
          description: Prometheus text format metrics
          content:
            text/plain:
              schema:
                type: string
  /auth/login:
    post:
      tags: [Auth]
      summary: Login and issue JWT access token + refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: Authenticated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthLoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRefreshRequest'
      responses:
        '200':
          description: Refreshed access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthRefreshResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout and revoke refresh token
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLogoutRequest'
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                required: [ok]
                properties:
                  ok:
                    type: boolean
                    example: true
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/me:
    get:
      tags: [Auth]
      summary: Get current authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Authenticated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /admin/audit-logs:
    get:
      tags: [Admin]
      summary: Read audit logs (platform admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 500
        - in: query
          name: actorUserId
          schema:
            type: string
        - in: query
          name: entityType
          schema:
            type: string
        - in: query
          name: tenantId
          schema:
            type: string
        - in: query
          name: action
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Audit log rows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLogRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /subscriptions/plans:
    get:
      tags: [Tenants]
      summary: List available subscription plans
      responses:
        '200':
          description: Plan catalog
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SubscriptionPlanCatalogItem'
  /tenants:
    get:
      tags: [Tenants]
      summary: List tenants with current subscription
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tenant list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TenantWithSubscription'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Tenants]
      summary: Create tenant and initial subscription
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantCreateRequest'
      responses:
        '201':
          description: Tenant created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantWithSubscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Duplicate tenant id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /tenants/{tenantId}/subscription:
    get:
      tags: [Tenants]
      summary: Get tenant subscription
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: tenantId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tenant subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSubscription'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Tenants]
      summary: Replace tenant subscription
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: tenantId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantSubscriptionUpdateRequest'
      responses:
        '200':
          description: Updated subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSubscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /tenants/{tenantId}/subscription/status:
    patch:
      tags: [Tenants]
      summary: Update tenant subscription status
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: tenantId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantSubscriptionStatusUpdateRequest'
      responses:
        '200':
          description: Updated subscription status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSubscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /payments/razorpay/order:
    post:
      tags: [Payments]
      summary: Create Razorpay order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RazorpayOrderCreatePayload'
      responses:
        '200':
          description: Razorpay order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RazorpayOrderResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
  /payments/razorpay/verify:
    post:
      tags: [Payments]
      summary: Verify Razorpay payment signature
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RazorpayVerifyPayload'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RazorpayVerifyResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /orders:
    post:
      tags: [Orders]
      summary: Create order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderCreatePayload'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '409':
          description: Duplicate order id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      tags: [Orders]
      summary: List orders
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/OrderStatus'
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: tenantId
          schema:
            type: string
      responses:
        '200':
          description: Orders list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /orders/customer/request-otp:
    post:
      tags: [Orders]
      summary: Request OTP for customer self-service order lookup.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerLookupOtpRequest'
      responses:
        '200':
          description: OTP request accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerLookupOtpResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '403':
          $ref: '#/components/responses/Forbidden'
  /orders/customer/lookup:
    post:
      tags: [Orders]
      summary: Lookup customer orders with phone + OTP.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerOrderLookupRequest'
      responses:
        '200':
          description: Matching orders for the verified customer.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /orders/{orderId}:
    get:
      tags: [Orders]
      summary: Get order by id
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderRecord'
        '404':
          $ref: '#/components/responses/NotFound'
  /orders/{orderId}/status:
    patch:
      tags: [Orders]
      summary: Update order status
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: Updated order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /orders/{orderId}/delivery-confirmation:
    post:
      tags: [Orders]
      summary: Confirm delivered order with OTP and fee collection details
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeliveryConfirmationPayload'
      responses:
        '200':
          description: Delivery confirmed and order closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /tracking/{orderId}:
    get:
      tags: [Tracking]
      summary: Get live tracking state
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tracking state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrackingState'
        '404':
          $ref: '#/components/responses/NotFound'
  /tracking/{orderId}/location:
    post:
      tags: [Tracking]
      summary: Push rider location update
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrackingLocationUpdate'
      responses:
        '200':
          description: Update accepted
          content:
            application/json:
              schema:
                type: object
                required: [ok]
                properties:
                  ok:
                    type: boolean
                    example: true
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /notifications/whatsapp/confirmation:
    post:
      tags: [Notifications]
      summary: Queue customer order confirmation WhatsApp message
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WhatsAppConfirmationRequest'
      responses:
        '200':
          description: Queued successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WhatsAppConfirmationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    BadRequest:
      description: Invalid request payload
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Entity not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Missing or invalid authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Authenticated but not allowed for this operation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    PaymentRequired:
      description: Tenant subscription is inactive for operational actions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    AppRole:
      type: string
      enum:
        - platform_admin
        - restaurant_owner
        - manager
        - dispatch
        - kitchen
        - rider
        - customer
    AuthUser:
      type: object
      required: [userId, email, name, role, tenantId]
      properties:
        userId:
          type: string
        email:
          type: string
        name:
          type: string
        role:
          $ref: '#/components/schemas/AppRole'
        tenantId:
          type: string
    AuthLoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string
    AuthRefreshRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
    AuthLogoutRequest:
      type: object
      properties:
        refreshToken:
          type: string
    AuthLoginResponse:
      type: object
      required: [accessToken, tokenType, expiresIn, refreshToken, user]
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: Bearer
        expiresIn:
          type: string
          example: 15m
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/AuthUser'
    AuthRefreshResponse:
      type: object
      required: [accessToken, tokenType, expiresIn, user]
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: Bearer
        expiresIn:
          type: string
          example: 15m
        user:
          $ref: '#/components/schemas/AuthUser'
    SubscriptionPlan:
      type: string
      enum: [monthly, quarterly, yearly]
    SubscriptionStatus:
      type: string
      enum: [trial, active, past_due, suspended, cancelled]
    SubscriptionPlanCatalogItem:
      type: object
      required: [plan, durationDays, amount, currency]
      properties:
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
        durationDays:
          type: integer
          minimum: 1
        amount:
          type: number
          minimum: 0
        currency:
          type: string
          enum: [INR]
    Tenant:
      type: object
      required: [tenantId, name, createdAt, updatedAt]
      properties:
        tenantId:
          type: string
        name:
          type: string
        createdAt:
          type: integer
          format: int64
        updatedAt:
          type: integer
          format: int64
    TenantSubscription:
      type: object
      required:
        - tenantId
        - plan
        - status
        - amount
        - currency
        - startAt
        - currentPeriodStart
        - currentPeriodEnd
        - updatedAt
      properties:
        tenantId:
          type: string
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
        status:
          $ref: '#/components/schemas/SubscriptionStatus'
        amount:
          type: number
          minimum: 0
        currency:
          type: string
          enum: [INR]
        startAt:
          type: integer
          format: int64
        currentPeriodStart:
          type: integer
          format: int64
        currentPeriodEnd:
          type: integer
          format: int64
        updatedAt:
          type: integer
          format: int64
    TenantWithSubscription:
      allOf:
        - $ref: '#/components/schemas/Tenant'
        - type: object
          required: [subscription]
          properties:
            subscription:
              nullable: true
              allOf:
                - $ref: '#/components/schemas/TenantSubscription'
    TenantCreateRequest:
      type: object
      required: [tenantId, name]
      properties:
        tenantId:
          type: string
        name:
          type: string
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
        status:
          $ref: '#/components/schemas/SubscriptionStatus'
    TenantSubscriptionUpdateRequest:
      type: object
      required: [plan, status]
      properties:
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
        status:
          $ref: '#/components/schemas/SubscriptionStatus'
        startAt:
          type: integer
          format: int64
    TenantSubscriptionStatusUpdateRequest:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/SubscriptionStatus'
    CurrencyCode:
      type: string
      enum: [INR]
    OrderStatus:
      type: string
      enum:
        - created
        - confirmed
        - preparing
        - out_for_delivery
        - delivered
        - cancelled
    OrderPaymentMethod:
      type: string
      enum: [razorpay, whatsapp]
    DeliveryFeeMode:
      type: string
      enum: [prepaid, collect_at_drop, restaurant_settled]
    DeliveryFeeSettlementStatus:
      type: string
      enum: [not_applicable, pending_collection, collected, restaurant_settled]
    DeliveryCollectionMethod:
      type: string
      enum: [cash, upi]
    OrderCustomerInfo:
      type: object
      required: [name, phone]
      properties:
        name:
          type: string
        phone:
          type: string
        email:
          type: string
    OrderAddress:
      type: object
      required: [line1, city]
      properties:
        line1:
          type: string
        city:
          type: string
        notes:
          type: string
    OrderTotals:
      type: object
      required: [subtotal, deliveryFee, tax, grandTotal]
      properties:
        subtotal:
          type: number
        deliveryFee:
          type: number
        tax:
          type: number
        grandTotal:
          type: number
        payableNow:
          type: number
        deliveryFeeDueAtDrop:
          type: number
    DeliveryFeeCollection:
      type: object
      required: [amountCollected, method, collectedAt, collectedBy]
      properties:
        amountCollected:
          type: number
        method:
          $ref: '#/components/schemas/DeliveryCollectionMethod'
        collectedAt:
          type: integer
          format: int64
        collectedBy:
          type: string
        notes:
          type: string
    DeliveryConfirmation:
      type: object
      required: [otpVerified]
      properties:
        expectedOtp:
          type: string
        receivedOtp:
          type: string
        otpVerified:
          type: boolean
        proofNote:
          type: string
        deliveredAt:
          type: integer
          format: int64
        confirmedBy:
          type: string
    OrderItem:
      type: object
      required: [id, name, type, image, price, calories, quantity]
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        image:
          type: string
        price:
          type: number
        calories:
          type: string
        quantity:
          type: integer
          minimum: 1
    OrderCreatePayload:
      type: object
      required:
        - orderId
        - customer
        - address
        - items
        - totals
        - paymentMethod
        - paymentReference
      properties:
        orderId:
          type: string
        tenantId:
          type: string
        customer:
          $ref: '#/components/schemas/OrderCustomerInfo'
        address:
          $ref: '#/components/schemas/OrderAddress'
        items:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderItem'
        totals:
          $ref: '#/components/schemas/OrderTotals'
        paymentMethod:
          $ref: '#/components/schemas/OrderPaymentMethod'
        paymentReference:
          type: string
        deliveryFeeMode:
          $ref: '#/components/schemas/DeliveryFeeMode'
        deliveryFeeSettlementStatus:
          $ref: '#/components/schemas/DeliveryFeeSettlementStatus'
        deliveryFeeCollection:
          $ref: '#/components/schemas/DeliveryFeeCollection'
        deliveryConfirmation:
          $ref: '#/components/schemas/DeliveryConfirmation'
    OrderRecord:
      allOf:
        - $ref: '#/components/schemas/OrderCreatePayload'
        - type: object
          required: [status, createdAt, updatedAt]
          properties:
            status:
              $ref: '#/components/schemas/OrderStatus'
            createdAt:
              type: integer
              format: int64
            updatedAt:
              type: integer
              format: int64
    CustomerLookupOtpRequest:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
        tenantId:
          type: string
    CustomerLookupOtpResponse:
      type: object
      required: [requestId, expiresAt]
      properties:
        requestId:
          type: string
        expiresAt:
          type: integer
          format: int64
        debugOtp:
          type: string
          description: Present only in debug mode.
    CustomerOrderLookupRequest:
      type: object
      required: [phone, requestId, otpCode]
      properties:
        phone:
          type: string
        requestId:
          type: string
        otpCode:
          type: string
    RazorpayOrderCreatePayload:
      type: object
      required: [orderReference, amount, currency]
      properties:
        orderReference:
          type: string
        amount:
          type: number
          minimum: 0.01
        currency:
          $ref: '#/components/schemas/CurrencyCode'
    RazorpayOrderResponse:
      type: object
      required: [provider, providerOrderId, amount, currency, keyId]
      properties:
        provider:
          type: string
          enum: [razorpay]
        providerOrderId:
          type: string
        amount:
          type: number
        currency:
          $ref: '#/components/schemas/CurrencyCode'
        keyId:
          type: string
    RazorpayVerifyPayload:
      type: object
      required: [orderReference, providerOrderId, paymentId, signature]
      properties:
        orderReference:
          type: string
        providerOrderId:
          type: string
        paymentId:
          type: string
        signature:
          type: string
    RazorpayVerifyResponse:
      type: object
      required: [verified, paymentReference]
      properties:
        verified:
          type: boolean
        paymentReference:
          type: string
        message:
          type: string
    TrackingPoint:
      type: object
      required: [lat, lng]
      properties:
        lat:
          type: number
        lng:
          type: number
    TrackingEvent:
      type: object
      required: [status, label, time]
      properties:
        status:
          type: string
          enum: [assigned, picked_up, on_the_way, nearby, delivered]
        label:
          type: string
        time:
          type: integer
          format: int64
    TrackingState:
      type: object
      required:
        - orderId
        - tenantId
        - status
        - agentName
        - agentPhone
        - etaMinutes
        - current
        - events
        - updatedAt
      properties:
        orderId:
          type: string
        tenantId:
          type: string
        status:
          type: string
          enum: [assigned, picked_up, on_the_way, nearby, delivered]
        agentName:
          type: string
        agentPhone:
          type: string
        etaMinutes:
          type: integer
        current:
          $ref: '#/components/schemas/TrackingPoint'
        events:
          type: array
          items:
            $ref: '#/components/schemas/TrackingEvent'
        updatedAt:
          type: integer
          format: int64
    TrackingLocationUpdate:
      type: object
      required: [lat, lng, status, etaMinutes]
      properties:
        lat:
          type: number
        lng:
          type: number
        status:
          type: string
          enum: [assigned, picked_up, on_the_way, nearby, delivered]
        etaMinutes:
          type: integer
          minimum: 0
    DeliveryConfirmationPayload:
      type: object
      required: [otpCode, confirmedBy, collectDeliveryFee]
      properties:
        otpCode:
          type: string
        proofNote:
          type: string
        confirmedBy:
          type: string
        collectDeliveryFee:
          type: boolean
        collectionAmount:
          type: number
        collectionMethod:
          $ref: '#/components/schemas/DeliveryCollectionMethod'
        collectionNotes:
          type: string
    WhatsAppConfirmationRequest:
      type: object
      required: [orderId, customerName, customerPhone, message]
      properties:
        orderId:
          type: string
        customerName:
          type: string
        customerPhone:
          type: string
        message:
          type: string
    WhatsAppConfirmationResponse:
      type: object
      required: [queued, channel]
      properties:
        queued:
          type: boolean
        channel:
          type: string
          enum: [whatsapp]
        providerMessageId:
          type: string
    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
    AuditLogRecord:
      type: object
      required: [id, action, entityType, status, details, createdAt]
      properties:
        id:
          type: string
        actorUserId:
          type: string
          nullable: true
        actorEmail:
          type: string
          nullable: true
        action:
          type: string
        entityType:
          type: string
        entityId:
          type: string
          nullable: true
        tenantId:
          type: string
          nullable: true
        status:
          type: string
        details:
          type: object
          additionalProperties: true
        createdAt:
          type: integer
          format: int64
