<main class="admin-shell">
  <section class="admin-head">
    <p class="kicker">Kitchen Console</p>
    <h1>Manage Live Orders</h1>
    <p>
      Update order pipeline from confirmation to delivery. This screen is intended
      for kitchen and dispatch staff.
    </p>
  </section>

  <section class="toolbar">
    <div class="filters" role="tablist" aria-label="Order status filters">
      @for (status of statusFilters; track status) {
        <button
          type="button"
          class="pill"
          [class.active]="filter() === status"
          (click)="setFilter(status)"
          role="tab"
          [attr.aria-selected]="filter() === status">
          {{ statusLabel(status) }}
          <span>{{ statusCounters()[status] }}</span>
        </button>
      }
    </div>

    <button type="button" class="refresh-btn" (click)="refresh()">Refresh</button>
  </section>

  @if (errorMessage()) {
    <section class="error-box">
      {{ errorMessage() }}
    </section>
  }

  @if (loading()) {
    <section class="placeholder">Loading orders...</section>
  } @else if (filteredOrders().length === 0) {
    <section class="placeholder">No orders available for this status.</section>
  } @else {
    <section class="order-grid">
      @for (order of filteredOrders(); track trackOrder($index, order)) {
        <article class="order-card">
          <div class="card-head">
            <div>
              <p class="order-id">Order {{ order.orderId }}</p>
              <h2>{{ order.customer.name }}</h2>
            </div>
            <span class="status-chip" [class]="'status-chip ' + order.status">
              {{ statusLabel(order.status) }}
            </span>
          </div>

          <div class="meta-grid">
            <p><strong>Phone:</strong> {{ order.customer.phone }}</p>
            <p><strong>City:</strong> {{ order.address.city }}</p>
            <p><strong>Payment:</strong> {{ paymentLabel(order.paymentMethod) }}</p>
            <p><strong>Total:</strong> INR {{ order.totals.grandTotal }}</p>
            <p><strong>Pay Now:</strong> INR {{ order.totals.payableNow ?? order.totals.grandTotal }}</p>
            <p><strong>Fee Mode:</strong> {{ order.deliveryFeeMode || 'prepaid' }}</p>
            <p><strong>Settlement:</strong> {{ order.deliveryFeeSettlementStatus || 'not_applicable' }}</p>
            <p><strong>Placed:</strong> {{ order.createdAt | date: 'medium' }}</p>
            <p><strong>Updated:</strong> {{ order.updatedAt | date: 'mediumTime' }}</p>
          </div>

          <div class="items-list">
            @for (item of order.items; track item.id + '-' + item.quantity) {
              <div class="item-row">
                <img [src]="item.image" [alt]="item.name" />
                <div>
                  <p>{{ item.name }}</p>
                  <small>{{ item.quantity }} x INR {{ item.price }}</small>
                </div>
              </div>
            }
          </div>

          <div class="actions">
            @if (nextStatuses(order).length === 0) {
              <p class="done-note">No further actions.</p>
            } @else {
              @for (next of nextStatuses(order); track next) {
                <button
                  type="button"
                  [disabled]="!canUpdate(order, next)"
                  (click)="updateStatus(order, next)">
                  Move to {{ statusLabel(next) }}
                </button>
              }
            }
          </div>
        </article>
      }
    </section>
  }
</main>
